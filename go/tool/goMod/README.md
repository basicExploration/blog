## go mod goå®˜æ–¹çš„moduleç®¡ç†å·¥å…·

#### ç”¨æ³•ï¼š

åœ¨ä¸€ä¸ªégo pathçš„è·¯å¾„ä¸­æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œç„¶åä½¿ç”¨`go mod init` å°±å¯ä»¥åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„åŒ…(è¦å¼€å¯è¿™ä¸ª `export GO111MODULE=on`å†™å…¥.bash_profileå³å¯ winçš„åŒå­¦è‡ªå·±æ‰¾æ‰¾è®¾ç½® GO111MODULEçš„winç‰ˆæœ¬è®¾ç½®æ–¹æ³•å“ˆ)ï¼Œå…¶å®è·Ÿgithub(gitlabéƒ½è¡Œ)ç”¨åœ¨ä¸€èµ·æ›´å¥½

1. åœ¨githubä¸Šæ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œä¾‹å¦‚è¯´ test
2. åœ¨æœ¬åœ°å°†è¿™ä¸ªè¿œç¨‹åŒ…ç»™cloneè¿‡æ¥ï¼Œç„¶åè¿™ä¸ªæ–‡ä»¶å¤¹é‡Œé¢å°±æ˜¯ä¸€ä¸ª.git éšè—çš„æ–‡ä»¶é¡¹ç›®è¿™ä¸ªå°±æ˜¯gitçš„ç®¡ç†æ–‡ä»¶åŒ…
3. å°†æ­¤åŒ…æ”¾åœ¨è¿œç¦» go pathçš„æ–‡ä»¶è·¯å¾„é‡Œï¼Œç„¶åä½¿ç”¨ `go mod init` å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º github.com/XXX/testçš„åŒ…
è®°ä½ï¼Œè¿™ä¸ªåŒ…åä¸èƒ½éšæ„ç§°å‘¼ï¼Œä½ çš„æ–‡ä»¶å¤¹çš„åç§°å°±æ˜¯ä½ çš„åŒ…åç„¶åé‡Œé¢çš„XX.goçš„åå­—æ— æ‰€è°“ï¼Œåªè¦`package test`ç”¨å¯¹å°±å¯ä»¥äº†ï¼Œç„¶åä½ ä¼šå‘ç°ä½ çš„åŒ…å†…å‡ºç°äº†ä¸¤ä¸ªæ–‡ä»¶ **go.sum** å’Œ **go.mod**  è¿™ä¸ªsumåŒ…ä½ å¯ä»¥å¿½ç•¥ï¼Œä¸»è¦æ˜¯go.modåŒ…è¿™é‡Œçš„åŒ… é¦–å…ˆå¼€å¤´æ˜¯ module github.com/XXX/test å£°æ˜äº† è¿™ä¸ªåŒ…çš„å…·ä½“åç§°æ˜¯ **"github.com/XXX/test"** ä½†æ˜¯åœ¨è°ƒç”¨çš„æ—¶å€™ åŒ…çš„åç§°æ˜¯ testä¸ºä»€ä¹ˆmoduleåé¢è¦åŠ ä¸Šæ‰€æœ‰çš„è·¯å¾„å‘¢ï¼ŒåŸå› ä¹Ÿæ˜¯å¾ˆç®€å•ï¼Œå°±æ˜¯å½“ä½  `go get github.com/xxx/test`çš„æ—¶å€™ç”¨ï¼Œä¸ç„¶ä½ åªæœ‰ä¸€ä¸ªtest go getæ˜¯æ²¡åŠæ³•ä¸‹è½½è¿™ä¸ªåŒ…çš„ã€‚
4. å°†è¿™ä¸ªåŒ…å‘å¸ƒåˆ°githubå³å¯ã€‚

## ç‰ˆæœ¬
- ä½ æœ¬åœ°çš„é¡¹ç›®å¼•ç”¨åˆ«äººçš„åŒ…çš„æ—¶å€™å¯ä»¥åœ¨go.mod ä¸­æŒ‡å®šversionçš„ç‰ˆæœ¬ï¼Œä½†æ˜¯ä»€ä¹ˆéƒ½ä¸æŒ‡å®šä¹Ÿå¯ä»¥ï¼Œé»˜è®¤æ˜¯latestï¼Œä¹Ÿå°±æ˜¯ä½ ç›´æ¥`go get github.com/xx/app`çš„æ—¶å€™å®ƒè‡ªåŠ¨å°±æ˜¯å¼•å…¥latestçš„ç‰ˆæœ¬äº†ï¼Œè¦æŒ‡å®šæŸä¸ªç‰ˆæœ¬ï¼Œä½ åœ¨go.mod æ”¹äº†å°±è¡Œäº†ã€‚å½“åŒ…ä¸­æœªä½¿ç”¨å…·ä½“versionçš„æ—¶å€™ï¼Œç¬¬ä¸‰ä¸ªäººç”¨ä½ çš„åŒ…æ—¶å€™ç„¶åé»˜è®¤ä¸‹è½½ä½ çš„åŒ…å¼•ç”¨çš„åŒ…çš„ç‰ˆæœ¬ï¼Œindirectçš„åŒ…ï¼ˆéç›´æ¥å¼•ç”¨çš„åŒ…ï¼‰çš„ç‰ˆæœ¬æ˜¯æœ€æ–°çš„é‚£ä¸ªç‰ˆæœ¬ï¼Œè¿™é‡Œçš„æœ€æ–°å°±è·Ÿä½ çš„æœ€æ–°ä¸æ˜¯ä¸€å›äº‹äº†ï¼Œå¦‚æœå¼•ç”¨çš„åŒ…çš„go.modä¸­æ˜ç¡®æŒ‡æ˜äº†versionè€Œä¸æ˜¯latestè¿™ç§å½¢å¼ï¼Œé‚£ä¹ˆä½ å¼•ç”¨å®ƒçš„æ—¶å€™å®ƒçš„é—´æ¥åŒ…çš„ç‰ˆæœ¬é»˜è®¤è·Ÿä½ çš„æ˜¯ç›¸åŒçš„ï¼Œä¸è¿‡ä½ è‡ªå·±ä¹Ÿå¯ä»¥æ›´æ”¹çš„å“¦ï¼ˆèƒ½æ˜ç™½å§æˆ‘æ„Ÿè§‰æœ‰ç‚¹ç»•ï¼ŒğŸ˜ï¼‰
ä¸¾ä¾‹å­ï¼š

è¿™æ˜¯ginçš„go.modæ‘˜é€‰
```go
	github.com/gin-contrib/sse v0.0.0-20190124093953-61b50c2ef482
	github.com/golang/protobuf v1.2.0

```
è¿™æ˜¯æˆ‘æœ¬åœ°é¡¹ç›®çš„go.modæ‘˜é€‰ï¼š
```go
github.com/gin-contrib/sse v0.0.0-20190125020943-a7658810eb74 // indirect
github.com/golang/protobuf v1.2.0 // indirect
```
ä½ ä¼šå‘ç°åŒæ ·éƒ½æ˜¯v1.2.0 ä½†æ˜¯ä¸Šé¢çš„é‚£ä¸ª ä¸€ä¸ªæ˜¯ 20190124 ä¸€ä¸ªæ˜¯20190125,æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸‹è½½åŒ…çš„æ—¶å€™çš„bashçš„æˆªå›¾
```bash
finding github.com/stretchr/testify/assert latest
```
å¦‚æœä½ ç”¨çš„åŒ…å®ƒç”¨çš„åŒ…ï¼Œå®ƒæ²¡æœ‰æŒ‡å®šå…·ä½“çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä½ çš„latestè·Ÿä»–çš„å°±å¯èƒ½ä¸æ˜¯ä¸€å›äº‹äº†ï¼Œè¿™ä¸ªè¦æ¸…æ¥šã€‚å› ä¸ºgo get ä¸‹è½½çš„æ—¶å€™æ˜¯æ­¤æ—¶æ­¤åˆ»çš„latestã€‚

`require github.com/coastroad/test v0.0.0-20190216094021-0555a706efff // indirect`
è¿™é‡Œ åé¢å°±æ˜¯æŒ‡å®šçš„ç‰ˆæœ¬ // indirectå°±æ˜¯é—´æ¥å¼•ç”¨çš„æ„æ€ã€‚
- ä½ çš„åŒ…çš„å…·ä½“versionå…¶å®æ˜¯ gitæ¥ç®¡ç†çš„ 1 ä½ å¯ä»¥ä½¿ç”¨ git push -tag æ¥æŒ‡å®šæŸä¸€ä¸ªversion.
ç¬¬äºŒä½ å¯ä»¥é€‰æ‹©ä¸å†™version
ç„¶ååˆ«äººç”¨ä½ çš„åŒ…çš„æ—¶å€™å°±ä¸èƒ½æŒ‡å®šè¿™ä¸ªversionäº†åªèƒ½ç”¨ latestæ¥å¼•å…¥åŒ… é€šå¸¸æ¥è¯´æ˜¯ä½ æœ€åç¼–è¾‘çš„æ—¥æœŸä¾‹å¦‚`v0.0.0-20190216094-55a706efff`

- ç‰ˆæœ¬ version2.X version 3.Xè¯¥æ€ä¹ˆåŠï¼Ÿgo modå®˜æ–¹æ¨èçš„æ–¹æ³•å¦‚ä¸‹

```go
module github.com/xxx/test/v2

```
ä¹Ÿå°±æ˜¯è¯´ä½ çš„åŒ…çš„åå­—è¿˜æ˜¯testä½†æ˜¯å› ä¸ºç‰ˆæœ¬æ˜¯v2.X æ‰€ä»¥è¦åœ¨åŒ…ååé¢åŠ å…¥å¤§ç‰ˆæœ¬å· /v2(ä¸€å®šæ˜¯v+æ•°å­— æ¯”å¦‚ v2 v3 v4 v5ä¸èƒ½æ”¹å˜å†™æ³•ä¹Ÿä¸èƒ½ç”¨v2.3è¿™ç§å†™æ³•)
ç„¶å è°ƒç”¨çš„æ—¶å€™æ˜¯è¿™æ ·çš„

```go

package dd

import(
"github.com/xxx/test/v2"
)

func dd(){

test.Test()
}
```
ä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨imprtçš„æ—¶å€™ ä¹Ÿè¦åŠ  v2å¤§ç‰ˆæœ¬å·ï¼Œä½†æ˜¯åœ¨å‡½æ•°å†…è°ƒç”¨çš„æ—¶å€™ è¿˜æ˜¯test æ¯”å¦‚è¿™ä¸ªæ—¶å€™ä½ çš„ç‰ˆæœ¬æ˜¯v2.45
é‚£ä¹ˆ ä½ çš„modæ–‡ä»¶é‡Œæœ€åçš„æ ‡æ³¨å°±æ˜¯v2.45

> å°±ç®—ä¸æ˜¯v2.45  ä¸é€šè¿‡æ‰“tagçš„æ–¹å¼æ¥å‘å¸ƒ æ¯”å¦‚è¿˜æ˜¯é»˜è®¤çš„æ•°å­—ï¼Œé‚£ä¹ˆåªè¦ä½ åœ¨modä¸­æŒ‡å®šæ˜¯v2 ä½ çš„ç‰ˆæœ¬å¤§å·å°±æ˜¯v2
åœ¨importä¸­å¼•å…¥è¿˜æ˜¯éœ€è¦åŠ ä¸Šv2 åªæ˜¯åœ¨modä¸­ æ˜¾ç¤ºçš„ä¿¡æ¯æ˜¯ä½ çš„æœ€åç¼–è¾‘æ—¶é—´ã€‚

è¿˜æœ‰ç§å†™æ³•æ˜¯
```go
module github.com/xx/app.v2
```
è¿™ç§å†™æ³•ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œåªæ˜¯å®˜æ–¹ä¸æ¨èè¿™ç§å†™æ³•ã€‚

ç»¼ä¸Šï¼š

```go
// ä½ çš„åŒ…
go.mod æ–‡ä»¶å†™æ³• : module github.com/xxx/test/v2

åˆ«äººç”¨ä½ çš„åŒ…çš„å†™æ³• import(
"github.com/xxx/test/v2"
)

func dd(){
test.Test()
}
```
### åŒ…çš„å­˜æ”¾ä½ç½®

å†ä½¿ç”¨äº†go modåä½ çš„go pathå°†æ²¡æœ‰ç”¨äº†ï¼Œä½†æ˜¯å­˜æ”¾çš„åŒ…çš„ä½ç½®è¿˜æ˜¯åœ¨ è€çš„go path æ›´æ˜ç¡®æ¥è¯´æ˜¯åœ¨ $gopath/srcè·¯å¾„
è¿™ä¸ªè·¯å¾„ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ pkg bin å‰é¢è¿™ä¸ªåŒ…æ˜¯å­˜æ”¾çš„éå¯æ‰§è¡Œçš„åŒ… åé¢çš„binæ”¾ç½®çš„å°±æ˜¯å¯æ‰§è¡Œçš„åŒ…ï¼Œä½ å¯ä»¥æŠŠpathæŒ‡å‘è¿™ä¸ªbinå³å¯ã€‚

### go mod tidy

è¿™ä¸ªå‘½ä»¤å¾ˆæœ‰ç”¨ é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹å®ƒçš„å®˜æ–¹è§£é‡Š **tidy: add missing and remove unused modules**
ä¹Ÿå°±æ˜¯è¯´ ä½ çš„go.modä¸­å¤šå¼•å…¥çš„æˆ–è€…æ˜¯å°‘å¼•å…¥çš„ ä½¿ç”¨ `go mod tidy` å®ƒå¯ä»¥å¸®ä½ å¤„ç†

### æˆ‘çš„åŒ…æ˜¯å¯æ‰§è¡Œçš„æ–‡ä»¶ï¼Œæˆ‘å‘å¸ƒåˆ°githubä¸Šè®©äººä½¿ç”¨æˆ‘çš„modè¯¥æ€ä¹ˆåŠ
ä½ çš„go.mod å¯ä»¥å†™æˆ `github.com/xxx/test`ä½†æ˜¯ä½ çš„æ–‡ä»¶çš„package åº”è¯¥å†™æˆmain æˆ–è€…ç›®å‰è€Œè¨€åœ¨githubä¸Šçš„
å¯æ‰§è¡Œæ–‡ä»¶çš„åŒ…æ²¡æœ‰go.modä¹Ÿå¯ä»¥ï¼Œä½ åªéœ€è¦åœ¨æœ¬åœ°å¼€å‘çš„æ—¶å€™æœ‰go.modå³å¯ã€‚ç„¶åè¿™ä¸ªgo.mod ä¸­çš„åç§°ä¸è·Ÿpackageä¸€æ ·ä¹Ÿå¯ä»¥
å› ä¸ºåˆ«äººæ˜¯ä¸ä¼šå†å¼•ç”¨ä½ çš„åŒ…çš„äº†ã€‚ä½†æ˜¯å¦‚æœä½ çš„åŒ…æœ‰å­åŒ…ï¼Œé‚£ä¹ˆä½ è¿˜æ˜¯åº”è¯¥æŠŠä½ çš„åŒ…go.modæ–‡ä»¶é‡Œçš„ module åé¢è§„è§„çŸ©çŸ©çš„å†™ä¾‹å¦‚
```go
module github.com/XXX/add

ç„¶ååˆ«äººå¼•ç”¨çš„æ—¶å€™
import(
"gitub.com/xxx/ddd/app" // app æ˜¯å­åŒ… å³å¯ã€‚
)
```
### æˆ‘æ— æ³•ä½¿ç”¨goalng.org/xçš„åŒ…æˆ‘è¯¥æ€ä¹ˆåŠ

ä¾‹å¦‚:
ä½ æœ¬åœ°çš„åŒ…è¦å¼•å…¥ golang.org/x/net/html
ä½†æ˜¯è¢«å°äº†ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨githubä¸Šçš„é•œåƒåŒ… ä¾‹å¦‚è¯´æ˜¯ github.com/golang/x/net/html

åœ¨ä½ çš„é¡¹ç›®çš„go.mod ä¸­ åŠ å…¥ replace golang.org/x/net/html => github.com/golang/x/net/html
ä½†æ˜¯ä¸€èˆ¬ä½ ç§‘å­¦ä¸Šç½‘ä¸å°±è¡Œäº†å—ã€‚ã€‚
### æˆ‘è¯¥æ€ä¹ˆå¤„ç†æˆ‘çš„å­åŒ…å’Œæˆ‘çš„åŒ…çš„å…³ç³»
- æœ¬åœ°
åœ¨æœ¬åœ° æ¯”å¦‚è¯´ä½ çš„å¤§åŒ…è¦å¼•ç”¨å­åŒ…çš„å†…å®¹ä½ å¯ä»¥go.mod ä¸­ä½¿ç”¨replaceï¼Œæ¯”å¦‚github.com/app/ä¸­
è¦å¼•å…¥ github.com/app/appçš„ä¸œè¥¿ï¼Œä½ å¯ä»¥ åœ¨go.mod ä¸­ ç”¨ replace github.com/app/app => ./app å³å¯
å½“,ä½ å‘å¸ƒçš„æ—¶å€™ä½ æŠŠè¿™ä¸ªreplaceåˆ æ‰å³å¯ã€‚ï¼ˆä»…é™ *Unixç³»ç»Ÿï¼Œå°±æ˜¯æ”¹å˜è·¯å¾„è€Œå·²ï¼Œwinçš„åŒå­¦è‡ªå·±çœ‹çœ‹å’‹å¼„å°±okäº†ï¼Œåæ­£å‘å¸ƒçš„æ—¶å€™è¦åˆ é™¤ï¼‰

### å½“æˆ‘çš„æ–‡ä»¶å¤¹çš„åç§°è·Ÿæˆ‘çš„packageå†™çš„åŒ…åä¸ä¸€æ ·æ€ä¹ˆåŠ

è¦è®°å¾— ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ˆåŒ…ï¼‰å†…çš„package åç§°å¿…é¡»ç›¸åŒï¼Œä½†æ˜¯å¯ä»¥ä¸è·Ÿæ–‡ä»¶å¤¹çš„åç§°ä¸€æ ·ï¼Œä½¿ç”¨çš„æ—¶å€™å…¶å®å¾ˆä¸çˆ½å°±æ˜¯äº†
ä¸è¿‡ä¹Ÿå¯ä»¥ç”¨ ç”¨æ³•æ˜¯

æ¯”å¦‚ä¸€ä¸ªåŒ… å®ƒçš„æ–‡ä»¶å¤¹æ˜¯ app ä½†æ˜¯ packageä¸­çš„åç§°æ˜¯ app1 é‚£ä¹ˆå¯ä»¥è¿™ä¹ˆç”¨

```go
imoirt "github.com/xxx/app" //  è¿™ä¸ªåœ°æ–¹è¦è·Ÿæ–‡ä»¶å¤¹çš„åç§°ä¿æŒä¸€è‡´ å…¶å®å°±æ˜¯è·Ÿè·¯å¾„ä¿æŒä¸€è‡´
func dd(){
app1.xxx// è¿™é‡Œè¦è·ŸçœŸå®çš„packageä¿æŒä¸€è‡´ ä½ çœ‹ å¾—ä¸å¿å¤±å§ æ‰€ä»¥ æ–‡ä»¶å¤¹çš„åç§°è¦è·Ÿpackageçš„åç§°ä¿æŒä¸€è‡´

}
```

### æ³¨æ„

ä½ çš„åŒ…å¦‚æœå­˜æ”¾åœ¨githubä¸Š ä½ çš„åŒ…çš„go.mod moduleåé¢ä¸€å®šæ˜¯github.com/xxx/xxxä¸èƒ½ç›´æ¥å†™æˆ xxx è¿™æ ·çš„è¯
go mod æ— æ³•è·å¾—åŒ… é”™è¯¯æ˜¯`parsing go.mod: unexpected module path "test"
                 go: error loading module requirements
`
æ€»ç»“ï¼š
- ä¹Ÿå°±æ˜¯è¯´ go.mod çš„module è¦è·Ÿgo get xx/xxx ä¿æŒä¸€è‡´ ä¾‹ï¼š`module github.com/app/app` åœ¨ä½¿ç”¨
å¼€å¯ go modå ä½¿ç”¨go get çš„æ—¶å€™ä¹Ÿæ˜¯ `go get github.com/app/app`

- æ–‡ä»¶å¤¹å¯ä»¥ä¸è·Ÿpackageçš„å…·ä½“åŒ…åä¿æŒä¸€è‡´ï¼Œimportçš„æ—¶å€™æ˜¯ç”¨çš„æ–‡ä»¶å¤¹åï¼ˆè·¯å¾„ï¼‰ï¼Œ å‡½æ•°ä¸­æ—¶å€™æ˜¯ç”¨çš„packageçš„åå­—

- æœ‰mainåŒ…çš„æ—¶å€™ go.mod è¦è·Ÿæ–‡ä»¶å¤¹çš„åç§°ä¿æŒä¸€è‡´ï¼Œå­åŒ…è¯¥æ€ä¹ˆå¼•å…¥å°±æ€ä¹ˆå¼•å…¥ ä¾‹å¦‚ github.com/app/dd
ddæ˜¯å­åŒ… appè¿™ä¸ªè·¯å¾„ä¸­æ˜¯mainåŒ…ã€‚

### âš ï¸

- æ–‡ä»¶åŒ…çš„åç§°å’Œpackageçš„åç§°è¦ä¿æŒä¸€è‡´(mainåŒ…é™¤å¤–)
- è¦ç”¨go mod ä»£æ›¿ go path å’Œdep å¤§åŠ¿æ‰€è¶‹
- go modä¸­çš„moduleåç§°ä¸€å®šè¦è·Ÿgitubä¸Šçš„è·¯å¾„ï¼ˆå…¶å®æ˜¯gitçš„è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„æ²¡æœ‰githubä¸Šçš„tree/masterï¼‰ä¿æŒä¸€è‡´ã€‚ä¸ç„¶æ²¡åŠæ³•æ‹‰å–
- å­åŒ…å’ŒåŒ…ä¸èƒ½äº’ç›¸å¼•ç”¨å¯ä»¥å°å¼•å¤§ä¹Ÿå¯ä»¥å¤§å¼•å°ä½†æ˜¯ä¸èƒ½äº’ç›¸ã€‚
- ä¸è¦æŠŠé¡¹ç›®æ”¾åˆ°go pathä¸­äº†ï¼Œgo pathè¦å–æ¶ˆäº†ã€‚ï¼ˆæˆ‘çŒœçš„ï¼‰
- æœ€å ä½¿ç”¨ `go help mod `æœ‰å‡ ä¸ªå‘½ä»¤ä¸Šé¢æœ‰æç¤ºã€‚å°±ä¸ä¸€ä¸€è§£é‡Šäº†ã€‚

```go
The commands are:

	download    download modules to local cache
	edit        edit go.mod from tools or scripts
	graph       print module requirement graph
	init        initialize new module in current directory
	tidy        add missing and remove unused modules
	vendor      make vendored copy of dependencies
	verify      verify dependencies have expected content
	why         explain why packages or modules are needed


```
